{% extends 'layouts/main.html' %}
{% load static %}
{% block head %}
<style>
	.zoom img {
		pointer-events: none;
	  }
	  
</style>
{% endblock head %}


{% block body %}


    <div class="hero-wrap hero-bread" style="background-image: url('images/bg_6.jpg');">
      <div class="container">
        <div class="row no-gutters slider-text align-items-center justify-content-center">
          <div class="col-md-9 ftco-animate text-center">
          	<p class="breadcrumbs"><span class="mr-2"><a href="index.html">Home</a></span> <span class="mr-2"><a href="index.html">Product</a></span> <span>Product Single</span></p>
            <h1 class="mb-0 bread">Product Single</h1>
          </div>
        </div>
      </div>
    </div>

    <section class="ftco-section">
    	<div class="container">
    		<div class="row">

 
				 {% comment %} <div class="col-lg-6 mb-5 ftco-animate"> 

    				<a href="images/menu-2.jpg" class="zoom" onmousemove="zoom(event)" onmouseout="resetZoom(event)"><img src="/media/{{ single_product.images }}" id="product-image" class="img-fluid" alt="Colorlib Template"></a>
    			
				</div> {% endcomment %}

				<div class="col-lg-6 mb-5 ftco-animate"> 
					<a href="images/menu-2.jpg" class="zoom" onmousemove="zoom(event)" onmouseout="resetZoom(event)">
						<img src="/media/{{ single_product.images }}" id="product-image" class="img-fluid" alt="Colorlib Template">
					</a>
				</div>

				
    			<div class="col-lg-6 product-details pl-md-5 ftco-animate">
				<form action="{% url 'add_to_cart' single_product.id %}" method="POST">
						{% csrf_token %} 
    				<h3>{{ single_product.product_name }}</h3>
    	
    				<p class="price"><span>₹{{ single_product.product_price}}</span></p>
    				<p>{{ single_product.product_name }} {{ single_product.description }}</p>

						<div class="row mt-4">
						<div class="col-md-6">
							<div class="form-group d-flex">
								<div class="select-wrap">
									<div class="icon"><span class="ion-ios-arrow-down"></span></div>
									<select name="variant" id="variant-select" class="form-control" required>
										<option value="">Select a Variant</option>
										{% for variant in variation %}
											<option value="{{ variant.id }}">{{ variant.variant_colour | capfirst }}{{ variant.id }}</option>
										{% endfor %}
									</select>
								</div>
							</div>
							
							<!-- Add an empty <div> to display stock status -->
							<div id="stock-status"></div>
							
							
                    <div> <p style="color: #000;" id="variant-status"></p></div>
					<p id="variant-stock"> pieces available</p>

														
		                </div>
				{% for variant in variation %}
				{% if variant.variant_stock <= 0 %}
					<h3 class="text-danger">Out Of Stock!</h3>
			    {% else %}
				
					<input type="submit" class="btn btn-black py-3 px-5 mt-2" name="action" value="add to cart"></input>
				{% endif %}	
				{% endfor %}
					<input type="submit" class="btn btn-black py-3 px-5 mt-2" name="action" value="add to wishlist"></input>


					
				 
		
			</form>
	

          	</div>
    			</div>
    		</div>
			
    	</div>
    </section>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script>
		$(document).ready(function(){

		var quantitiy=0;
		   $('.quantity-right-plus').click(function(e){
		        
		        // Stop acting like a button
		        e.preventDefault();
		        // Get the field name
		        var quantity = parseInt($('#quantity').val());
		        
		        // If is not undefined
		            
		            $('#quantity').val(quantity + 1);

		          
		            // Increment
		        
		    });

		     $('.quantity-left-minus').click(function(e){
		        // Stop acting like a button
		        e.preventDefault();
		        // Get the field name
		        var quantity = parseInt($('#quantity').val());
		        
		        // If is not undefined
		      
		            // Increment
		            if(quantity>0){
		            $('#quantity').val(quantity - 1);
		            }
		    });
		    
		});
	</script>

	<script>
		$(document).ready(function() {
			console.log("heloooooooooooooooooooooooooooooooooo")
			$('#variant-select').change(function() {
			  var selectedVariantId = $(this).val();
			  console.log(selectedVariantId)
			$('#cid').text(selectedVariantId)
			  // Perform an AJAX request to fetch the details of the selected variant
			  // Replace the URL with the actual endpoint that returns the variant details



			  $.ajax({
				url: '/get-variant-details',
				type: 'GET',
				data: { variantId: selectedVariantId },
		
				success: function(response)
				 {
				  // Update the product details on the page
				  var productImage = response.variant_image;
					  var variantName = response.variant_name;
					  var variantStock = response.variant_stock;
					  var variantStatus = response.variant_status;
					  
			   console.log(variantStock,'item stock')
		
				  // Update the image source and price text
				  $('#product-image').attr('src', productImage);
				  $('#variant-stock').text(variantStock + '  pieces available'); // Make sure to include the text "pieces available"
				  //$('#variant-status').text(variantStatus);
				  $('#product-price').text('₹'+ productPrice);
				  $('#product-variant-name').html(variantProduct +' '+ variantName);
					},
					error: function(xhr, status, error) {
					  // Handle error response if needed
					}
				  });
				});
			  }
			  );

	</script>
<script>
  function zoom(event) {
    var zoomer = event.currentTarget;
    var offsetX = event.offsetX ? event.offsetX : event.touches[0].pageX;
    var offsetY = event.offsetY ? event.offsetY : event.touches[0].pageY;
    var x = (offsetX / zoomer.offsetWidth) * 100;
    var y = (offsetY / zoomer.offsetHeight) * 100;
    zoomer.querySelector('img').style.transform = 'scale(1.3)';
    zoomer.querySelector('img').style.transformOrigin = x + '% ' + y + '%';
  }

  function resetZoom(event) {
    var zoomer = event.currentTarget;
    zoomer.querySelector('img').style.transform = 'none';
  }
</script> 

{% comment %} <script>
    function zoom(event) {
        var zoomer = event.currentTarget;
        var divWidth = zoomer.offsetWidth;
        var divHeight = zoomer.offsetHeight;
        var offsetX = event.offsetX ? event.offsetX : event.touches[0].pageX - zoomer.getBoundingClientRect().left;
        var offsetY = event.offsetY ? event.offsetY : event.touches[0].pageY - zoomer.getBoundingClientRect().top;
        var x = (offsetX / divWidth) * 100;
        var y = (offsetY / divHeight) * 100;
        
        var img = zoomer.querySelector('img');
        img.style.transform = 'scale(1.3)';
        img.style.transformOrigin = x + '% ' + y + '%';
    }

    function resetZoom(event) {
        var zoomer = event.currentTarget;
        var img = zoomer.querySelector('img');
        img.style.transform = 'none';
    }
</script> {% endcomment %} 


<script>
    $(document).ready(function() {
        $('#variant-select').change(function() {
            var selectedVariantId = $(this).val();
            console.log(selectedVariantId);

            // Perform an AJAX request to fetch the stock status of the selected variant
            $.ajax({
                url: '/get-variant-stock-status',
                type: 'GET',
                data: { variantId: selectedVariantId },
                success: function(response) {
                    var stockStatus = response.stock_status;
                    var stockMessage = stockStatus ? 'In Stock' : 'Out of Stock';
                    var stockColor = stockStatus ? 'text-success' : 'text-danger';
                    $('#stock-status').html('<h3 class="' + stockColor + '">' + stockMessage + '</h3>');
                },
				console.log(stockStatus,"kitty")
                error: function(xhr, status, error) {
                    // Handle error response if needed
                }
            });
        });
    });
</script>


  </body>
{% endblock body %}
</html>



   			{% comment %} <div class="col-lg-6 mb-5 ftco-animate">

    				<a href="images/menu-2.jpg" class="image-popup"><img src="/media/{{ single_product.images }}" id="product-image" class="img-fluid" alt="Colorlib Template"></a>
    			</div>
				 {% endcomment %}